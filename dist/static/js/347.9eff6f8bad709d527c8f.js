webpackJsonp([347],{bO8G:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("fAP+"),n=i("ieqt"),l=i("VU/8")(a.a,n.a,null,null,null);e.default=l.exports},"fAP+":function(t,e,i){"use strict";var a=i("woOf"),n=i.n(a),l=i("DAYN"),o=i.n(l),s=i("6ThG"),r="";e.a={components:{draggable:o.a},props:{popVisible:{type:Boolean,default:!1}},data:function(){return{imageUrl:"",btnsize:"mini",formModel:{labelList:[],paper:{width:0,height:0}},prxvalue:.3,classItem:[],orgLabelList:[],labelListView:[],rules:{},viewKey:0,flags:!1,isDragView:!1,isMove:!1,showDragDetail:!1,showDragTips:[],isShowDragTips:!0,isHiddenDragDetail:!0,isDrag:null,dragDetailInfo:{},dragCursor:"move",alignmentOptions:[{value:0,label:"文字靠右"},{value:1,label:"文字靠左"},{value:2,label:"文字居中"}],fontWeightOptions:[{value:0,label:"默认粗细"},{value:2,label:"加粗"}]}},watch:{popVisible:function(){this.popVisible?(this.dialogVisible=!0,this.getSettingCompanyLi()):this.dialogVisible=!1}},computed:{dialogVisible:{get:function(){return this.popVisible},set:function(){}},printPreviewContent:function(){var e=600,i=400,t=this.imageUrl;return this.formModel&&this.formModel.labelList.forEach(function(t){"setting"===t.filedValue&&(e=t.width,i=t.height)}),{width:e/this.prxvalue+"px",height:i/this.prxvalue+"px",backgroundImage:"url("+t+")",backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"0 0"}},printPreviewPaper:function(){},isActiveDrag:function(){return{}}},mounted:function(){this.getSettingCompanyLi(),document.addEventListener("mousemove",this.conrightMove,!0),document.addEventListener("mouseup",this.conrightEnd,!0)},methods:{handleChange:function(t,e){this.imageUrl=t.url},uploadHandleFile:function(t){},conrigthStart:function(t,e,i,a){this.isHiddenDragDetail=!1,e.x=t.pageX,e.y=t.pageY,e.orgwidth=Math.round(e.width/this.prxvalue),e.orgheight=Math.round(e.height/this.prxvalue),e.mousetype=a,this.isDrag=e},conrightMove:function(t){if(this.isDrag){var e=this.isDrag,i=e.mousetype,a=t.pageX-e.x,n=t.pageY-e.y;this.calcWH(e,a,n,i)}},calcWH:function(t,e,i,a){var n=t.orgwidth,l=t.orgheight;"right"!==a&&"bottomright"!==a||(n+=e),"bottom"!==a&&"bottomright"!==a||(l+=i),n=n<15?15:1e3<n?1e3:n,l=l<20?20:1e3<l?1e3:l,t.width=Math.round(n*this.prxvalue),t.height=Math.round(l*this.prxvalue)},conrightEnd:function(t){if(this.isDrag){var e=this.isDrag;e.x=t.pageX,e.y=t.pageY,this.isDrag=null}},addItemDrag:function(t,e){if(t.isshow)this.$notify.info({title:"消息",message:"【 "+t.filedName+" 】已设置显示打印"});else{var i=n()({},t);i.isshow=!0,t.isshow=!0,this.labelListView.push(i)}this.editDragItem(t,e)},editDragItem:function(t,e,i){this.dragDetailInfo={},this.dragDetailInfo=n()({},t),this.classItem=[],this.showDragTips=[],this.classItem[e]&&i&&this.isHiddenDragDetail?(this.showDragDetail=!1,this.isHiddenDragDetail=!1):(this.isHiddenDragDetail=!0,this.classItem[e]=!0,this.showDragDetail=!0),this.showDragTips[e]=!0},changeDragDetailInfo:function(t){var i=this;t&&(this.labelListView.forEach(function(t,e){t.filedValue===i.dragDetailInfo.filedValue&&i.$set(i.labelListView,e,i.dragDetailInfo)}),this.formModel.labelList.forEach(function(t,e){"setting"===t.filedValue&&i.$set(i.formModel.labelList,e,i.formModel.paper),t.filedValue===i.dragDetailInfo.filedValue&&i.$set(i.formModel.labelList,e,i.dragDetailInfo)}))},review:function(){this.viewKey=(new Date).getTime(),this.formModel.labelList=[],this.labelListView=[],this.getSettingCompanyLi(),this.showDragDetail=!1,this.dragDetailInfo={},this.isDrag=null},dragStart:function(i,t,e){if(this.showDragTips[e]=!0,this.isDrag)return console.log("dragStart"),!1;this.isDragView=!0;var a=(r=i.currentTarget).getAttribute("data-fileName");this.isMove=!0,this.labelListView.forEach(function(t,e){t.filedValue===a&&(t.x=i.pageX,t.y=i.pageY)})},dragEnd:function(e,t,i){if(this.isDrag)return console.log("dragEnd"),!1;console.log(this.showDragTips[i]),this.isDragView=!0;var a=(r=e.currentTarget).getAttribute("data-fileName");this.isMove=!0,this.labelListView.forEach(function(t){t.filedValue===a&&(t.leftx+=e.pageX-t.x,t.topy+=e.pageY-t.y)}),console.log(t.leftx,t.width),(Math.round(t.leftx*this.prxvalue)+t.width<0||Math.round(t.topy*this.prxvalue)+t.height<0||t.leftx>Math.round(this.formModel.paper.width/this.prxvalue)||t.topy>Math.round(this.formModel.paper.height/this.prxvalue))&&(this.dragCursor="not-allowed",t.isshow=!1,this.dragDetailInfo={},this.showDragDetail=!1,this.labelListView=this.labelListView.filter(function(t,e){return e!==i})),this.editDragItem(t,i),this.dragCursor="move",this.showDragTips=[]},drag:function(t){this.isDragView=!1,this.isMove=!1,r=t.currentTarget},drop:function(e){e.preventDefault();var i=r.getAttribute("data-fileName"),t=!1;this.isMove||(t=!this.labelListView.filter(function(t){return t.filedValue===i}).length),t&&!this.isDragView&&this.labelListView.push(this.orgLabelList.filter(function(t){if(t.filedValue===i)return t.leftx=e.offsetX,t.topy=e.offsetY,t.isshow=!0})[0])},allowDrop:function(t){t.preventDefault()},getSettingCompanyLi:function(){var e=this;this.labelListView=[],this.viewKey=(new Date).getTime(),Object(s.e)().then(function(t){e.formModel.labelList=t,e.orgLabelList=t,e.formModel.labelList.forEach(function(t){t.width=Math.round((t.width?t.width:150)*e.prxvalue),t.height=Math.round((t.height?t.height:24)*e.prxvalue),"setting"===t.filedValue?e.formModel.paper=n()({},t):(t.isshow&&e.labelListView.push(t),t.fontsize=t.fontsize?t.fontsize:14,t.isshow=1===t.isshow,t.bold=2===t.bold,t.alignment=t.alignment?e.alignmentOptions[t.alignment].label:"文字靠左")})})},closeMe:function(t){this.$emit("close"),"function"==typeof t&&t()},checkNull:function(t){return null!=t&&""!==t&&void 0},submitForm:function(t){var i=this;this.$refs[t].validate(function(t){t&&(i.formModel.labelList.forEach(function(e){if(i.checkNull(e.topy)||i.checkNull(e.leftx)||i.checkNull(e.width)||i.checkNull(e.height))return i.$message({type:"warning",message:"不能为空"}),!1;console.log(e.width),e.width=Math.round(e.width/i.prxvalue),e.height=Math.round(e.height/i.prxvalue),console.log(e.width),e.isshow=e.isshow?1:0,e.bold=e.bold?2:0,i.alignmentOptions.forEach(function(t){e.alignment===t.label&&(e.alignment=t.value)})}),Object(s.g)(i.formModel.labelList).then(function(t){i.$message({type:"success",message:"标签打印设置成功！"}),i.getSettingCompanyLi(),i.viewKey=(new Date).getTime()}))})},resetForm:function(t){var e=this;this.$refs[t].validate(function(t){t&&e.$confirm("此操作将所有设置重置为0,重置后不可恢复,是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.formModel.labelList.forEach(function(t){t.topy=0,t.leftx=0,t.width=Math.round(150*e.prxvalue),t.height=Math.round(24*e.prxvalue),t.fontsize=14,t.bold=0,t.alignment=1})}).catch(function(t){e._handlerCatchMsg(t)})})},canDragStart:function(t){},handleSwitch:function(t){var i=this;this.showDragDetail=!1,this.dragDetailInfo.isshow,this.dragDetailInfo.isshow,this.formModel.labelList.forEach(function(t,e){t.filedValue===i.dragDetailInfo.filedValue&&i.$set(i.formModel.labelList,e,i.dragDetailInfo)}),this.labelListView=this.labelListView.filter(function(t){return t.filedValue!==i.dragDetailInfo.filedValue})},changeValue:function(t,e,i){this.viewKey=(new Date).getTime()}}}},ieqt:function(t,e,i){"use strict";var a={render:function(){var n=this,t=n.$createElement,l=n._self._c||t;return l("el-dialog",{staticClass:"tms_dialog_print_drag",attrs:{title:"打印标签设置 (单位:毫米mm)",visible:n.dialogVisible,fullscreen:"","before-close":n.closeMe},on:{"update:visible":function(t){n.dialogVisible=t}}},[l("div",{key:n.viewKey,staticClass:"print_aside"},[l("div",{staticClass:"print_aside_head"},[l("span",[l("i",{staticClass:"el-icon-menu"}),n._v(" 字段列表 "+n._s(n.formModel.labelList.length)+" ")]),n._v(" "),l("el-popover",{staticStyle:{float:"right","margin-top":"0px","margin-left":"10px"},attrs:{placement:"right",width:"400",trigger:"hover"}},[l("span",[n._v("可将信息项手动拖拽到右边纸张中显示及设置位置和宽高；"),l("br"),n._v("(单位：毫米mm)")]),n._v(" "),l("i",{staticClass:"el-icon-warning",attrs:{slot:"reference"},slot:"reference"})]),n._v(" "),l("el-button",{staticStyle:{float:"right","margin-top":"10px"},attrs:{type:"success",icon:"el-icon-document",size:n.btnsize},on:{click:function(t){n.submitForm("formModel")}}},[n._v("保存")]),n._v(" "),l("el-button",{staticStyle:{float:"right","margin-top":"10px","margin-right":"10px"},attrs:{icon:"el-icon-document",size:n.btnsize},on:{click:n.review}},[n._v("刷新")])],1),n._v(" "),l("el-form",{ref:"formModel",attrs:{model:n.formModel,rules:n.rules,"label-width":"0px"}},[l("ul",{staticClass:"print_aside_content"},[l("transition-group",n._l(n.formModel.labelList,function(e,i){return"setting"!==e.filedValue?l("li",{key:i,attrs:{draggable:"true","data-fileName":e.filedValue},on:{dragstart:function(t){n.drag(t)},click:function(t){n.addItemDrag(e,i)}}},[e.isshow?l("i",{staticClass:"el-icon-circle-check showLabel"}):n._e(),n._v(" "),l("b",[n._v(n._s(e.filedName))])]):n._e()}))],1),n._v(" "),l("div",{staticClass:"prinit_aside_paper"},[l("span",[l("i",{staticClass:"el-icon-document"}),n._v(" 纸张设置")]),n._v(" "),l("br"),n._v(" "),l("el-form-item",[l("el-input",{directives:[{name:"number-only",rawName:"v-number-only:point",arg:"point"}],attrs:{placeholder:"请输入内容",size:"mini"},on:{change:n.changeDragDetailInfo},model:{value:n.formModel.paper.width,callback:function(t){n.$set(n.formModel.paper,"width",t)},expression:"formModel.paper.width"}},[l("template",{slot:"prepend"},[n._v("宽")]),n._v(" "),l("template",{slot:"append"},[n._v("mm")])],2)],1),n._v(" "),l("el-form-item",[l("el-input",{directives:[{name:"number-only",rawName:"v-number-only:point",arg:"point"}],attrs:{placeholder:"请输入内容",size:"mini"},on:{change:n.changeDragDetailInfo},model:{value:n.formModel.paper.height,callback:function(t){n.$set(n.formModel.paper,"height",t)},expression:"formModel.paper.height"}},[l("template",{slot:"prepend"},[n._v("高")]),n._v(" "),l("template",{slot:"append"},[n._v("mm")])],2)],1)],1),n._v(" "),l("el-collapse-transition",[n.showDragDetail?l("div",[l("div",{staticClass:"prinit_aside_detail"},[l("span",[l("i",{staticClass:"el-icon-setting"}),n._v(" "+n._s(n.dragDetailInfo.filedName))]),n._v(" "),l("span",[n._v(n._s(" ("+n.dragDetailInfo.leftx+", "+n.dragDetailInfo.topy+")"))]),n._v(" "),l("br"),n._v(" "),l("el-form-item",[l("el-input",{directives:[{name:"number-only",rawName:"v-number-only:point",arg:"point"}],attrs:{placeholder:"请输入内容",size:"mini"},on:{change:n.changeDragDetailInfo},model:{value:n.dragDetailInfo.width,callback:function(t){n.$set(n.dragDetailInfo,"width",t)},expression:"dragDetailInfo.width"}},[l("template",{slot:"prepend"},[n._v("宽")]),n._v(" "),l("template",{slot:"append"},[n._v("mm")])],2)],1),n._v(" "),l("el-form-item",[l("el-input",{directives:[{name:"number-only",rawName:"v-number-only:point",arg:"point"}],attrs:{placeholder:"请输入内容",size:"mini"},on:{change:n.changeDragDetailInfo},model:{value:n.dragDetailInfo.height,callback:function(t){n.$set(n.dragDetailInfo,"height",t)},expression:"dragDetailInfo.height"}},[l("template",{slot:"prepend"},[n._v("高")]),n._v(" "),l("template",{slot:"append"},[n._v("mm")])],2)],1),n._v(" "),l("el-form-item",[l("el-input",{directives:[{name:"numberOnly",rawName:"v-numberOnly"}],attrs:{placeholder:"请输入内容",size:"mini"},on:{change:n.changeDragDetailInfo},model:{value:n.dragDetailInfo.fontsize,callback:function(t){n.$set(n.dragDetailInfo,"fontsize",t)},expression:"dragDetailInfo.fontsize"}},[l("template",{slot:"prepend"},[n._v("字号")])],2)],1),n._v(" "),l("el-form-item",[l("el-checkbox",{attrs:{label:"加粗",border:"",size:"mini"},on:{change:n.changeDragDetailInfo},model:{value:n.dragDetailInfo.bold,callback:function(t){n.$set(n.dragDetailInfo,"bold",t)},expression:"dragDetailInfo.bold"}}),n._v(" "),l("el-switch",{attrs:{"active-color":"#67c23a","active-text":n.dragDetailInfo.isshow?"显示":"隐藏"},on:{change:n.handleSwitch},model:{value:n.dragDetailInfo.isshow,callback:function(t){n.$set(n.dragDetailInfo,"isshow",t)},expression:"dragDetailInfo.isshow"}})],1),n._v(" "),l("el-form-item",{staticClass:"print_itemSet_col"},[l("el-radio-group",{attrs:{size:"mini"},on:{change:n.changeDragDetailInfo},model:{value:n.dragDetailInfo.alignment,callback:function(t){n.$set(n.dragDetailInfo,"alignment",t)},expression:"dragDetailInfo.alignment"}},n._l(n.alignmentOptions,function(t){return l("el-radio-button",{key:t.value,attrs:{label:t.label,border:""}})}))],1)],1)]):n._e()]),n._v(" "),l("div",{staticClass:"prinit_aside_setpreview"},[l("div",{staticClass:"prinit_aside_setpreview_head"},[l("span",[l("i",{staticClass:"el-icon-picture"}),n._v(" 打印背景图片效果预览")]),n._v(" "),n.imageUrl?l("el-button",{staticStyle:{float:"right","margin-right":"10px","margin-top":"10px"},attrs:{icon:"el-icon-delete",size:n.btnsize},on:{click:function(t){n.imageUrl=""}}},[n._v("清除背景")]):n._e()],1),n._v(" "),l("el-upload",{attrs:{drag:"","show-file-list":!1,"on-change":n.handleChange,action:"","http-request":n.uploadHandleFile}},[l("i",{staticClass:"el-icon-upload"}),n._v(" "),l("div",{staticClass:"el-upload__text"},[n._v("将文件拖到此处，或"),l("em",[n._v("点击上传")])])])],1),n._v(" "),l("div",{staticClass:"prinit_aside_info"},[l("el-button",{attrs:{type:"warning",icon:"el-icon-document",size:n.btnsize},on:{click:function(t){n.resetForm("formModel")}}},[n._v("全部重置为默认值")])],1)],1)],1),n._v(" "),l("div",{staticClass:"print_main"},[l("div",{staticClass:"print_main_head"},[l("b",[n._v("预览展示:")]),l("span",[n._v(" 纸张大小(宽×高)："+n._s(this.formModel.paper.width+" (毫米mm) × "+this.formModel.paper.height+" (毫米mm)"))])]),n._v(" "),l("div",{key:n.viewKey,staticClass:"print_main_content",style:n.printPreviewContent,on:{drop:function(t){n.drop(t)},dragover:function(t){n.allowDrop(t)}}},n._l(n.labelListView,function(i,a){return l("div",{staticClass:"previewBlock",class:{isActiveDrag:n.classItem[a]},style:{cursor:n.dragCursor,transform:"translate("+i.leftx+"px,"+i.topy+"px)",width:i.width/n.prxvalue+"px",height:i.height/n.prxvalue+"px",lineHeight:i.height/n.prxvalue-3+"px",fontSize:i.fontsize+"px",whiteSpace:"nowrap",fontWeight:i.bold?800:400,textAlign:"文字居中"===i.alignment?"center":"文字靠右"===i.alignment?"right":"left"},attrs:{draggable:"true","data-fileName":i.filedValue},on:{dragstart:function(t){return n.dragStart(t,i,a)},dragend:function(t){return n.dragEnd(t,i,a)},click:function(t){n.editDragItem(i,a,t)}}},[n.showDragTips[a]?l("div",{staticClass:"dragTips"},[n._v("\n          "+n._s("(x :"+Math.round(i.leftx*n.prxvalue)+" mm, y :"+Math.round(i.topy*n.prxvalue)+" mm)")+" "+n._s("(宽: "+i.width+" mm, 高: "+i.height+" mm)")+"\n        ")]):n._e(),n._v(" "),l("div",{staticClass:"dragSizeControler"},[l("span",[n._v(n._s("{ "+i.filedName+" }"))]),n._v(" "),l("div",{staticClass:"conrigth",on:{dragstart:function(t){t.preventDefault(),t.stopPropagation()},"!mousedown":function(t){return t.preventDefault(),t.stopPropagation(),e=t,n.conrigthStart(e,i,a,"right");var e}}}),n._v(" "),l("div",{staticClass:"conbottom",on:{"!dragstart":function(t){t.preventDefault(),t.stopPropagation()},"!mousedown":function(t){return t.preventDefault(),t.stopPropagation(),e=t,n.conrigthStart(e,i,a,"bottom");var e}}}),n._v(" "),l("div",{staticClass:"conbottomright",on:{"!dragstart":function(t){t.preventDefault(),t.stopPropagation()},"!mousedown":function(t){return t.preventDefault(),t.stopPropagation(),e=t,n.conrigthStart(e,i,a,"bottomright");var e}}})])])}))])])},staticRenderFns:[]};e.a=a}});