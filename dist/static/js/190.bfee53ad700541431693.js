webpackJsonp([190],{"0yYY":function(t,e,r){"use strict";var i=r("woOf"),o=r.n(i),a=r("Dd8w"),n=r.n(a),l=r("E4LH"),s=r("QBRH"),c=r("9ani"),u=r("P5Di"),d=r("QbVN"),p=r("o9X6"),m=r("NYxO"),f=r("9UCZ");e.a={components:{popRight:u.a,Upload:d.a,SelectTree:p.a,SelectType:f.a},props:{popVisible:{type:Boolean,default:!1},orgid:{required:!0},isModify:{type:Boolean,default:!1},info:{type:Object,default:function(){}},truckTypes:{type:Array,default:function(){return[]}},truckSources:{type:Array,default:function(){return[]}}},computed:n()({},Object(m.mapGetters)(["otherinfo"])),data:function(){var t=function(i,o){return function(t,e,r){i<e?r(new Error(o)):r()}};return{form:{dirverMobile:"",driverId:"",orgid:"",truckBrand:"",truckHeight:"",truckIdNumber:"",truckLength:"",truckLoad:"",truckRegisterDate:"",truckRemarks:"",truckScrapDate:"",truckSource:"",truckType:"",truckUnit:"",truckUnitMobile:"",truckVolume:"",truckWidth:"",drivingLicense:"",operatingLicense:"",vehiclePic:""},formLabelWidth:"100px",tooltip:!1,rules:{truckIdNumber:[{required:!0,message:"请输入车牌号码",trigger:"blur"}],orgid:[{required:!0,message:"请选择所属机构",trigger:"blur"}],driverMobile:[{message:"请输入手机号码",trigger:"blur",pattern:l.a.MOBILE}],truckLoad:[{validator:t(1e3,"吨数不能超过1000吨"),type:"number"}],truckVolume:[{validator:t(1e3,"体积不能超过1000方"),type:"number"}],truckLength:[{validator:t(100,"车长不能超过100米"),type:"number"}],truckHeight:[{validator:t(20,"车高不能超过20米"),type:"number"}],truckWidth:[{validator:t(10,"车宽不能超过10米"),type:"number"}]},popTitle:"新增车辆",orgArr:[],rolesArr:[],departmentArr:[],loading:!1,roles:[],departments:[],groups:[],inited:!1,pickOption2:{firstDayOfWeek:1},cacheDriverList:{},DriverList:[]}},mounted:function(){this.form.orgid=this.orgid,this.inited||(this.inited=!0,this.initInfo())},watch:{popVisible:function(t,e){this.form.orgid=this.orgid,this.inited||(this.inited=!0,this.initInfo())},orgid:function(t,e){this.form.orgid=t},info:function(){if(this.isModify){this.popTitle="修改车辆";var t=o()({},this.info);for(var e in this.form)this.form[e]=t[e];this.form.truckId=t.truckId}else{for(var r in this.popTitle="新增车辆",this.form)this.form[r]=(this.form[r],"");delete this.form.truckId,this.form.orgid=this.orgid}}},methods:{getTreeOrgid:function(t){this.getDriverList(t)},initInfo:function(){this.loading=!1,this.getTreeOrgid(this.orgid)},getOrgid:function(t){this.form.orgid=t},submitForm:function(t){var r=this;this.$refs[t].validate(function(t){if(!t)return!1;r.loading=!0;var e=o()({},r.form);(r.isModify?Object(s.f)(e):Object(s.e)(e)).then(function(t){r.loading=!1,r.$message.success("保存成功"),r.closeMe(),r.$emit("success")}).catch(function(t){r._handlerCatchMsg(t),r.loading=!1})})},reset:function(){this.$refs.ruleForm.resetFields()},closeMe:function(t){this.reset(),this.$emit("update:popVisible",!1),"function"==typeof t&&t()},getDriverList:function(e){var r=this;this.cacheDriverList[e]?this.DriverList=this.cacheDriverList[e]:Object(c.b)({currentPage:1,pageSize:200,vo:{orgid:e}}).then(function(t){r.DriverList=t.list,r.cacheDriverList[e]=t.list}).catch(function(t){r.loading=!1,r._handlerCatchMsg(t)})}}}},"4g2A":function(t,e){},"613Z":function(t,e,r){"use strict";var i={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("pop-right",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"addTruckPop",attrs:{title:e.popTitle,isShow:e.popVisible},on:{close:e.closeMe}},[r("template",{staticClass:"addTruckPop-content",slot:"content"},[r("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":e.formLabelWidth,inline:!0,"label-position":"right",size:"mini"}},[r("el-form-item",{attrs:{label:"车牌号码",prop:"truckIdNumber"}},[r("el-input",{attrs:{maxlength:10,"auto-complete":"off"},model:{value:e.form.truckIdNumber,callback:function(t){e.$set(e.form,"truckIdNumber",t)},expression:"form.truckIdNumber"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"车辆来源",prop:"truckSource"}},[r("SelectType",{attrs:{type:"truck_source",placeholder:"请选择"},model:{value:e.form.truckSource,callback:function(t){e.$set(e.form,"truckSource",t)},expression:"form.truckSource"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"车型",prop:"truckType"}},[r("SelectType",{attrs:{type:"truck_type",placeholder:"请选择"},model:{value:e.form.truckType,callback:function(t){e.$set(e.form,"truckType",t)},expression:"form.truckType"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"可载重",prop:"truckLoad"}},[r("el-input",{attrs:{maxlength:18,"auto-complete":"off"},model:{value:e.form.truckLoad,callback:function(t){e.$set(e.form,"truckLoad",e._n(t))},expression:"form.truckLoad"}},[r("template",{slot:"append"},[e._v("吨")])],2)],1),e._v(" "),r("el-form-item",{attrs:{label:"可载体积",prop:"truckVolume"}},[r("el-input",{attrs:{maxlength:18,"auto-complete":"off"},model:{value:e.form.truckVolume,callback:function(t){e.$set(e.form,"truckVolume",e._n(t))},expression:"form.truckVolume"}},[r("template",{slot:"append"},[e._v("方")])],2)],1),e._v(" "),r("el-form-item",{attrs:{label:"车长",prop:"truckLength"}},[r("el-input",{attrs:{maxlength:18,"auto-complete":"off"},model:{value:e.form.truckLength,callback:function(t){e.$set(e.form,"truckLength",e._n(t))},expression:"form.truckLength"}},[r("template",{slot:"append"},[e._v("米")])],2)],1),e._v(" "),r("el-form-item",{attrs:{label:"车宽",prop:"truckWidth"}},[r("el-input",{attrs:{maxlength:20,"auto-complete":"off"},model:{value:e.form.truckWidth,callback:function(t){e.$set(e.form,"truckWidth",e._n(t))},expression:"form.truckWidth"}},[r("template",{slot:"append"},[e._v("米")])],2)],1),e._v(" "),r("el-form-item",{attrs:{label:"车高",prop:"truckHeight"}},[r("el-input",{attrs:{maxlength:20,"auto-complete":"off"},model:{value:e.form.truckHeight,callback:function(t){e.$set(e.form,"truckHeight",e._n(t))},expression:"form.truckHeight"}},[r("template",{slot:"append"},[e._v("米")])],2)],1),e._v(" "),r("el-form-item",{attrs:{label:"归属网点",prop:"orgid"}},[r("SelectTree",{attrs:{orgid:e.otherinfo.orgid},on:{change:e.getTreeOrgid},model:{value:e.form.orgid,callback:function(t){e.$set(e.form,"orgid",t)},expression:"form.orgid"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"车辆品牌",prop:"truckBrand"}},[r("el-input",{attrs:{maxlength:20,"auto-complete":"off"},model:{value:e.form.truckBrand,callback:function(t){e.$set(e.form,"truckBrand",t)},expression:"form.truckBrand"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"车辆注册时间",prop:"truckRegisterDate"}},[r("el-date-picker",{attrs:{align:"right",type:"date","picker-options":e.pickOption2,placeholder:"选择日期","value-format":"timestamp"},model:{value:e.form.truckRegisterDate,callback:function(t){e.$set(e.form,"truckRegisterDate",t)},expression:"form.truckRegisterDate"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"车辆报废时间",prop:"truckScrapDate"}},[r("el-date-picker",{attrs:{align:"right",type:"date","picker-options":e.pickOption2,placeholder:"选择日期","value-format":"timestamp"},model:{value:e.form.truckScrapDate,callback:function(t){e.$set(e.form,"truckScrapDate",t)},expression:"form.truckScrapDate"}})],1),e._v(" "),r("el-form-item",{staticClass:"truckRemarks",attrs:{label:"备注",prop:"truckRemarks"}},[r("el-input",{attrs:{type:"textarea",maxlength:300},model:{value:e.form.truckRemarks,callback:function(t){e.$set(e.form,"truckRemarks",t)},expression:"form.truckRemarks"}})],1),e._v(" "),r("div",{staticClass:"hr"}),e._v(" "),r("el-form-item",{attrs:{label:"车辆单位",prop:"truckUnit"}},[r("el-input",{attrs:{maxlength:20,"auto-complete":"off"},model:{value:e.form.truckUnit,callback:function(t){e.$set(e.form,"truckUnit",t)},expression:"form.truckUnit"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"单位电话",prop:"truckUnitMobile"}},[r("el-input",{directives:[{name:"numberOnly",rawName:"v-numberOnly"}],attrs:{maxlength:20,"auto-complete":"off"},model:{value:e.form.truckUnitMobile,callback:function(t){e.$set(e.form,"truckUnitMobile",t)},expression:"form.truckUnitMobile"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"司机",prop:"driverId"}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:e.form.driverId,callback:function(t){e.$set(e.form,"driverId",t)},expression:"form.driverId"}},e._l(e.DriverList,function(t){return r("el-option",{key:t.id,attrs:{label:t.driverName,value:t.id}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"司机电话",prop:"driverMobile"}},[r("el-input",{directives:[{name:"numberOnly",rawName:"v-numberOnly"}],attrs:{maxlength:20,"auto-complete":"off"},model:{value:e.form.dirverMobile,callback:function(t){e.$set(e.form,"dirverMobile",t)},expression:"form.dirverMobile"}})],1),e._v(" "),r("div",{staticClass:"hr"}),e._v(" "),r("el-form-item",{staticClass:"clearfix uploadcard"},[r("div",{staticClass:"idcard"},[r("upload",{attrs:{title:"行驶证"},model:{value:e.form.drivingLicense,callback:function(t){e.$set(e.form,"drivingLicense",t)},expression:"form.drivingLicense"}})],1),e._v(" "),r("div",{staticClass:"drviercard"},[r("upload",{attrs:{title:"营运执照"},model:{value:e.form.operatingLicense,callback:function(t){e.$set(e.form,"operatingLicense",t)},expression:"form.operatingLicense"}})],1),e._v(" "),r("div",{staticClass:"certcard"},[r("upload",{attrs:{title:"车辆照片"},model:{value:e.form.vehiclePic,callback:function(t){e.$set(e.form,"vehiclePic",t)},expression:"form.vehiclePic"}})],1)])],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("保 存")]),e._v(" "),r("el-button",{on:{click:e.closeMe}},[e._v("取 消")])],1)],2)},staticRenderFns:[]};e.a=i},"71e1":function(t,e,r){t.exports=r("+dzQ")(43)},EPeO:function(t,e,r){"use strict";var i=r("//Fk"),n=r.n(i),o=r("mvHQ"),a=r.n(o),l=(r("UDRQ"),r("t5DY")),s=r("0xDb"),c=r("71e1"),u=r.n(c),d=r("Vo7i");e.a={name:"singleImageUpload",props:{value:[String,Array],title:{type:String,default:""},tip:{type:String,default:"（jpg/png。小于5M）"},size:{type:String,default:"mini"},showFileList:{type:Boolean,default:!1},limit:{type:Number,default:1},listtype:{type:String,default:"picture",enum:["text","picture","picture-card"]},disabled:{type:Boolean,default:!1},twocode:{type:Boolean,default:!1}},computed:{imageUrl:function(){return this.value}},data:function(){return{tempUrl:"",dataObj:{token:"",key:""},upload:{key:"",policy:"",OSSAccessKeyId:"",success_action_status:"201",signature:""},uploadUrl:"",dir:"",filelist:[],showtc:!1,showtwocdetip:!0,twocodeurl:""}},watch:{showtc:function(){this.showtc?this.changeTwocode():clearInterval(this.uptimer)},value:{handler:function(t){if(this.showFileList){var e=Array.isArray(t)?t:t?t.split(","):[];e=e.filter(function(t){return t}),this.filelist=[],this.filelist=e.map(function(t){var e={};return e.url=t,e})}else this.filelist=t?[{url:t}]:[]},immediate:!0}},mounted:function(){},updated:function(){console.log("single image updated~~~")},beforeDestroy:function(){console.log("beforeDestroy"),clearInterval(this.uptimer)},methods:{init:function(){var e=this;return Object(l.m)().then(function(t){e.upload.OSSAccessKeyId=t.accessid,e.upload.policy=t.policy,e.upload.signature=t.signature,e.uploadUrl=t.host,e.dir=t.dir}).catch(function(){})},rmImage:function(e){this.filelist=this.filelist.filter(function(t){return t.url!==e}),this.emitInput(""),this.showtc=!1},onexceed:function(t,e){this.$message.error("最多上传 "+this.limit+" 张!")},handleRemove:function(t,e){console.log("handleRemove:",t,e),this.filelist=e,this.emitInput()},random_string:function(t){t=t||32;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",r=e.length,i="",o=0;o<t;o++)i+=e.charAt(Math.floor(Math.random()*r));return i},emitInput:function(t){t&&this.filelist.push({url:t}),this.$emit("input",this.showFileList?this.filelist.map(function(t){return t.url}).join(","):t)},handleImageScucess:function(t){var e="";-1!==t.indexOf("Location")&&(e=(e=t.match(/<Location>([^<]+)<\/Location>/m))?e[1]:""),this.emitInput(e)},handleError:function(t){this.$message.error("上传错误："+a()(t)),this.$emit("error",t)},handleUpload:function(t){var a=this;return new n.a(function(i,o){lrz(t.file,{width:1024}).then(function(t){var e=new FormData,r=a.uploadUrl;e.append("key",a.upload.key),e.append("success_action_status","201"),e.append("OSSAccessKeyId",a.upload.OSSAccessKeyId),e.append("policy",a.upload.policy),e.append("signature",a.upload.signature),e.append("file",t.file),d.b.post(r,e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){i(t)}).catch(function(t){o(t),a._handlerCatchMsg(t,"上传失败:")})}).catch(function(t){o(t),a._handlerCatchMsg(t,"上传失败：")})})},beforeUpload:function(t){var r=this,i=/image\/\w+/.test(t.type)&&/(jpe?g|png)/i.test(t.type),o=t.size/1024/1024<5,a=t.name.match(/([^\.]+)$/);return a=a?"."+a[1]:"",new n.a(function(e,t){i?o?r.init().then(function(t){r.upload.key=r.dir+Object(s.parseTime)(new Date,"{y}{m}{d}")+"/"+r.random_string()+a,e(!0)}).catch(function(t){r._handlerCatchMsg(t),e(!1)}):(r.$message.error("上传头像图片大小不能超过 5MB!"),t(!1)):(r.$message.error("上传头像图片只能是 JPG/PNG 格式!"),t(!1))})},changeTwocode:function(){var r=this;clearInterval(this.uptimer),Object(l.k)().then(function(t){r.upid=t.data,r.startFetchData();var e="http://"+location.host+"/static/upload.html?len=1&access_token="+r.access_token+"&id="+t.data+"&url="+(window.tms_testapiurl||"");console.log("url:",e),u.a.toDataURL(e,{rendererOpts:{margin:0}}).then(function(t){r.twocodeurl=t})}).catch(function(t){r.$message.error("生成二维码出错了~")})},startFetchData:function(){var r=this;clearInterval(this.uptimer);var t=0;this.uptimer=setInterval(function(){if(57e4<(t+=5e3))return r.$message.info("二维码过期了，已重新生成~"),r.changeTwocode(),!1;Object(l.l)(r.upid).then(function(t){var e=t.data;e&&e.id===r.upid&&e.url&&(clearInterval(r.uptimer),r.showtc=!1,r.emitInput(decodeURIComponent(e.url)))}).catch(function(t){r.$message.info("二维码过期了，请重新扫描上传~")})},5e3)}}}},GZnJ:function(t,e,r){"use strict";var i={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"upload-container",class:{uploadlist:e.showFileList}},[r("el-upload",{staticClass:"image-uploader",attrs:{data:e.upload,action:e.uploadUrl,multiple:!1,drag:!e.showFileList,"show-file-list":e.showFileList,"file-list":e.filelist,limit:e.limit,"before-upload":e.beforeUpload,"list-type":e.listtype,"on-exceed":e.onexceed,disabled:e.disabled,"on-remove":e.handleRemove,"on-error":e.handleError,"http-request":e.handleUpload,"on-success":e.handleImageScucess}},[e._t("content",[e.showtc?r("div",{staticClass:"twocodebox",on:{click:function(t){t.stopPropagation(),t.preventDefault()},mouseover:function(t){e.showtwocdetip=!0},mouseout:function(t){e.showtwocdetip=!1}}},[r("div",[r("img",{attrs:{src:e.twocodeurl,alt:""}})]),e._v(" "),r("el-button",{attrs:{size:e.size,type:"primary"},on:{click:function(t){e.showtc=!1}}},[e._v("本地上传")]),e._v(" "),r("el-button",{attrs:{size:e.size,type:"primary"},on:{click:e.changeTwocode}},[e._v("更换二维码")])],1):r("div",[e.title&&!e.showFileList?r("div",{staticClass:"upload__title"},[e._v(e._s(e.title))]):e._e(),e._v(" "),r("el-button",{attrs:{size:e.size,type:"primary"}},[e._v("点击上传")]),e._v(" "),e.twocode?r("el-button",{staticClass:"uploadtwocode",attrs:{size:e.size,type:"primary"},on:{click:function(t){t.stopPropagation(),t.preventDefault(),e.showtc=!0}}},[e._v("二维码上传")]):e._e(),e._v(" "),e.showFileList?e._e():r("div",{staticClass:"el-upload__text"},[e._v("将文件拖拽到此区域")]),e._v(" "),e.tip?r("div",{staticClass:"upload__tip"},[e._v(e._s(e.tip))]):e._e()],1)])],2),e._v(" "),e.imageUrl&&!e.showFileList?r("div",{staticClass:"image-preview"},[r("div",{staticClass:"image-preview-wrapper"},[r("img",{attrs:{src:e.imageUrl}}),e._v(" "),r("div",{staticClass:"image-preview-action"},[r("i",{staticClass:"el-icon-delete",on:{click:function(t){e.rmImage(e.imageUrl)}}})])])]):e._e()],1)},staticRenderFns:[]};e.a=i},Id8Z:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r("0yYY"),o=r("613Z");var a=function(t){r("KMS9")},n=r("VU/8")(i.a,o.a,a,null,null);e.default=n.exports},KMS9:function(t,e){},QbVN:function(t,e,r){"use strict";var i=r("EPeO"),o=r("GZnJ");var a=function(t){r("4g2A"),r("V9ir")},n=r("VU/8")(i.a,o.a,a,"data-v-6d858db4",null);e.a=n.exports},V9ir:function(t,e){}});