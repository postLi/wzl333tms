webpackJsonp([195],{"0Q33":function(t,e){},"71e1":function(t,e,i){t.exports=i("+dzQ")(43)},EPeO:function(t,e,i){"use strict";var a=i("//Fk"),l=i.n(a),n=i("mvHQ"),s=i.n(n),o=(i("UDRQ"),i("t5DY")),r=i("0xDb"),c=i("71e1"),u=i.n(c),p=i("Vo7i");e.a={name:"singleImageUpload",props:{value:[String,Array],title:{type:String,default:""},tip:{type:String,default:"（jpg/png。小于5M）"},size:{type:String,default:"mini"},showFileList:{type:Boolean,default:!1},limit:{type:Number,default:1},listtype:{type:String,default:"picture",enum:["text","picture","picture-card"]},disabled:{type:Boolean,default:!1},twocode:{type:Boolean,default:!1}},computed:{imageUrl:function(){return this.value}},data:function(){return{tempUrl:"",dataObj:{token:"",key:""},upload:{key:"",policy:"",OSSAccessKeyId:"",success_action_status:"201",signature:""},uploadUrl:"",dir:"",filelist:[],showtc:!1,showtwocdetip:!0,twocodeurl:""}},watch:{showtc:function(){this.showtc?this.changeTwocode():clearInterval(this.uptimer)},value:{handler:function(t){if(this.showFileList){var e=Array.isArray(t)?t:t?t.split(","):[];e=e.filter(function(t){return t}),this.filelist=[],this.filelist=e.map(function(t){var e={};return e.url=t,e})}else this.filelist=t?[{url:t}]:[]},immediate:!0}},mounted:function(){},updated:function(){console.log("single image updated~~~")},beforeDestroy:function(){console.log("beforeDestroy"),clearInterval(this.uptimer)},methods:{init:function(){var e=this;return Object(o.m)().then(function(t){e.upload.OSSAccessKeyId=t.accessid,e.upload.policy=t.policy,e.upload.signature=t.signature,e.uploadUrl=t.host,e.dir=t.dir}).catch(function(){})},rmImage:function(e){this.filelist=this.filelist.filter(function(t){return t.url!==e}),this.emitInput(""),this.showtc=!1},onexceed:function(t,e){this.$message.error("最多上传 "+this.limit+" 张!")},handleRemove:function(t,e){console.log("handleRemove:",t,e),this.filelist=e,this.emitInput()},random_string:function(t){t=t||32;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",i=e.length,a="",n=0;n<t;n++)a+=e.charAt(Math.floor(Math.random()*i));return a},emitInput:function(t){t&&this.filelist.push({url:t}),this.$emit("input",this.showFileList?this.filelist.map(function(t){return t.url}).join(","):t)},handleImageScucess:function(t){var e="";-1!==t.indexOf("Location")&&(e=(e=t.match(/<Location>([^<]+)<\/Location>/m))?e[1]:""),this.emitInput(e)},handleError:function(t){this.$message.error("上传错误："+s()(t)),this.$emit("error",t)},handleUpload:function(t){var s=this;return new l.a(function(a,n){lrz(t.file,{width:1024}).then(function(t){var e=new FormData,i=s.uploadUrl;e.append("key",s.upload.key),e.append("success_action_status","201"),e.append("OSSAccessKeyId",s.upload.OSSAccessKeyId),e.append("policy",s.upload.policy),e.append("signature",s.upload.signature),e.append("file",t.file),p.b.post(i,e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){a(t)}).catch(function(t){n(t),s._handlerCatchMsg(t,"上传失败:")})}).catch(function(t){n(t),s._handlerCatchMsg(t,"上传失败：")})})},beforeUpload:function(t){var i=this,a=/image\/\w+/.test(t.type)&&/(jpe?g|png)/i.test(t.type),n=t.size/1024/1024<5,s=t.name.match(/([^\.]+)$/);return s=s?"."+s[1]:"",new l.a(function(e,t){a?n?i.init().then(function(t){i.upload.key=i.dir+Object(r.parseTime)(new Date,"{y}{m}{d}")+"/"+i.random_string()+s,e(!0)}).catch(function(t){i._handlerCatchMsg(t),e(!1)}):(i.$message.error("上传头像图片大小不能超过 5MB!"),t(!1)):(i.$message.error("上传头像图片只能是 JPG/PNG 格式!"),t(!1))})},changeTwocode:function(){var i=this;clearInterval(this.uptimer),Object(o.k)().then(function(t){i.upid=t.data,i.startFetchData();var e="http://"+location.host+"/static/upload.html?len=1&access_token="+i.access_token+"&id="+t.data+"&url="+(window.tms_testapiurl||"");console.log("url:",e),u.a.toDataURL(e,{rendererOpts:{margin:0}}).then(function(t){i.twocodeurl=t})}).catch(function(t){i.$message.error("生成二维码出错了~")})},startFetchData:function(){var i=this;clearInterval(this.uptimer);var t=0;this.uptimer=setInterval(function(){if(57e4<(t+=5e3))return i.$message.info("二维码过期了，已重新生成~"),i.changeTwocode(),!1;Object(o.l)(i.upid).then(function(t){var e=t.data;e&&e.id===i.upid&&e.url&&(clearInterval(i.uptimer),i.showtc=!1,i.emitInput(decodeURIComponent(e.url)))}).catch(function(t){i.$message.info("二维码过期了，请重新扫描上传~")})},5e3)}}}},FUcU:function(t,e,i){"use strict";var a={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"component"},[i("h2",[e._v("上传图片")]),e._v(" "),i("h4",[e._v("默认样式")]),e._v(" "),i("UploadImage",{model:{value:e.url1,callback:function(t){e.url1=t},expression:"url1"}}),e._v(" "),i("h4",[e._v("定义标题")]),e._v(" "),i("UploadImage",{attrs:{title:"法人身份证正面"},model:{value:e.url2,callback:function(t){e.url2=t},expression:"url2"}}),e._v(" "),i("h4",[e._v("定义提示")]),e._v(" "),i("UploadImage",{attrs:{tip:"（有年检章，jpg/png。小于5M）"},model:{value:e.url3,callback:function(t){e.url3=t},expression:"url3"}}),e._v(" "),i("h4",[e._v("定义标题跟提示 + 默认值")]),e._v(" "),i("UploadImage",{attrs:{title:"法人身份证正面",tip:"（有年检章，jpg/png。小于5M）"},on:{success:e.getUrl},model:{value:e.url,callback:function(t){e.url=t},expression:"url"}}),e._v(" "),i("p",[e._v("上传后的链接地址："+e._s(e.url))]),e._v(" "),i("img",{attrs:{src:e.url}}),e._v(" "),i("h4",[e._v("展示预览列表")]),e._v(" "),i("UploadImage",{attrs:{showFileList:"",limit:2,listtype:"picture",tip:""},on:{success:e.getUrl},model:{value:e.url4,callback:function(t){e.url4=t},expression:"url4"}}),e._v(" "),i("p",[e._v("上传后的链接地址："+e._s(JSON.stringify(e.url4)))]),e._v(" "),i("h4",[e._v("二维码上传")]),e._v(" "),i("UploadImage",{staticClass:"twocodeimager",attrs:{twocode:"",tip:""},on:{success:e.getUrl},model:{value:e.url5,callback:function(t){e.url5=t},expression:"url5"}}),e._v(" "),i("blockquote",[e._v("\n    引用地址：\n    components/Upload/singleImage.vue\n  ")]),e._v(" "),i("h3",[e._v("prop")]),e._v(" "),e._m(0),e._v(" "),i("p",[e._v("注意事项：当showFileList为true时，v-model绑定的值为数组类型或者是以英文逗号分隔的图片链接")]),e._v(" "),i("h3",[e._v("event")]),e._v(" "),e._m(1)],1)},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("ul",[i("li",{staticClass:"info-require"},[t._v("v-model"),i("div",{staticClass:"type"},[t._v("String")]),t._v("用来绑定控件的值")]),t._v(" "),i("li",[t._v("title"),i("div",{staticClass:"type"},[t._v("String")]),t._v("标题")]),t._v(" "),i("li",[t._v("tip"),i("div",{staticClass:"type"},[t._v("String")]),t._v("提示信息")]),t._v(" "),i("li",[t._v("showFileList"),i("div",{staticClass:"type"},[t._v("Boolean")]),t._v("是否显示预览图")]),t._v(" "),i("li",[t._v("limit"),i("div",{staticClass:"type"},[t._v("Number")]),t._v("限制上传n张图片")]),t._v(" "),i("li",[t._v("listtype"),i("div",{staticClass:"type"},[t._v("String")]),t._v("展示形式，可取'text', 'picture', 'picture-card' ")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("ul",[i("li",[i("div",{staticClass:"function"},[t._v("success")]),t._v("返回当前控件的值，如 "),i("pre",[t._v("    'xxxx' // 上传后的链接  \n    ")])])])}]};e.a=a},HMrH:function(t,e,i){"use strict";var a=i("QbVN");e.a={components:{UploadImage:a.a},data:function(){return{url:"",url1:"",url2:"",url3:"",url4:["https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100"],url5:""}},methods:{getUrl:function(t){console.log("upload Url:",t)}}}},IJ74:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("HMrH"),n=i("FUcU");var s=function(t){i("oVEo")},l=i("VU/8")(a.a,n.a,s,null,null);e.default=l.exports},QbVN:function(t,e,i){"use strict";var a=i("EPeO"),n=i("jxZV");var s=function(t){i("0Q33"),i("xU5l")},l=i("VU/8")(a.a,n.a,s,"data-v-de7091b2",null);e.a=l.exports},jxZV:function(t,e,i){"use strict";var a={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"upload-container",class:{uploadlist:e.showFileList}},[i("el-upload",{staticClass:"image-uploader",attrs:{data:e.upload,action:e.uploadUrl,multiple:!1,drag:!e.showFileList,"show-file-list":e.showFileList,"file-list":e.filelist,limit:e.limit,"before-upload":e.beforeUpload,"list-type":e.listtype,"on-exceed":e.onexceed,disabled:e.disabled,"on-remove":e.handleRemove,"on-error":e.handleError,"http-request":e.handleUpload,"on-success":e.handleImageScucess}},[e._t("content",[e.showtc?i("div",{staticClass:"twocodebox",on:{click:function(t){t.stopPropagation(),t.preventDefault()},mouseover:function(t){e.showtwocdetip=!0},mouseout:function(t){e.showtwocdetip=!1}}},[i("div",[i("img",{attrs:{src:e.twocodeurl,alt:""}})]),e._v(" "),i("el-button",{attrs:{size:e.size,type:"primary"},on:{click:function(t){e.showtc=!1}}},[e._v("本地上传")]),e._v(" "),i("el-button",{attrs:{size:e.size,type:"primary"},on:{click:e.changeTwocode}},[e._v("更换二维码")])],1):i("div",[e.title&&!e.showFileList?i("div",{staticClass:"upload__title"},[e._v(e._s(e.title))]):e._e(),e._v(" "),i("el-button",{attrs:{size:e.size,type:"primary"}},[e._v("点击上传")]),e._v(" "),e.twocode?i("el-button",{staticClass:"uploadtwocode",attrs:{size:e.size,type:"primary"},on:{click:function(t){t.stopPropagation(),t.preventDefault(),e.showtc=!0}}},[e._v("二维码上传")]):e._e(),e._v(" "),e.showFileList?e._e():i("div",{staticClass:"el-upload__text"},[e._v("将文件拖拽到此区域")]),e._v(" "),e.tip?i("div",{staticClass:"upload__tip"},[e._v(e._s(e.tip))]):e._e()],1)])],2),e._v(" "),e.imageUrl&&!e.showFileList?i("div",{staticClass:"image-preview"},[i("div",{staticClass:"image-preview-wrapper"},[i("img",{attrs:{src:e.imageUrl}}),e._v(" "),i("div",{staticClass:"image-preview-action"},[i("i",{staticClass:"el-icon-delete",on:{click:function(t){e.rmImage(e.imageUrl)}}})])])]):e._e()],1)},staticRenderFns:[]};e.a=a},oVEo:function(t,e){},xU5l:function(t,e){}});