webpackJsonp([264],{"7nIZ":function(e,t,o){"use strict";t.i=function(e){return i.b.post("/api-finance/finance/tmsfinancebillrecord/v1.3/getBillRecordList/",e).then(function(e){return e.data})},t.h=function(e){return i.b.post("/api-finance/finance/tmsfinancebillrecorddetail/v1.3/getBillRecordDetailList/",e).then(function(e){return e.data})},t.j=function(e){return i.b.post("/api-finance/finance/tmsfinancebillrecord/v1.3/getVerificationBaseInfo/",e).then(function(e){return e.data})},t.g=function(e){return i.b.post("/api-finance/finance/tmsfinancebillrecord/v1.3/addIncome/",e).then(function(e){return e.data})},t.a=function(e){return i.b.post("/api-finance/finance/tmsfinancebillrecord/v1.3/cancelVerification/",e).then(function(e){return e.data})},t.f=function(e){return i.b.post("/api-finance/finance/tmsfinanceverification/v1.3/getVeryficationList/",e).then(function(e){return e.data})},t.b=function(e){return i.b.post("/api-finance//finance/tmsfinancebillrecord/v1.3/delBillRecord/",e).then(function(e){return e.data})},t.e=function(e){return i.b.post("/api-finance/finance/tmsfinancebillrecord/v1.3/getOrderList/",e).then(function(e){return e.data})},t.d=function(e){return i.b.post("/api-finance/finance/tmsfinancesubjects/v1.3/getFinanceSubjects/",e).then(function(e){return e.data})},t.c=function(e){return i.b.post("/api-finance/finance/tmsfinancebillrecord/v1.3/getBillRecordInfo",e).then(function(e){return e.data})};var i=o("Vo7i")},CmFX:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o("tdtH"),r=o("wgpT");var n=function(e){o("si/F")},s=o("VU/8")(i.a,r.a,n,null,null);t.default=s.exports},"si/F":function(e,t){},tdtH:function(e,t,o){"use strict";var i=o("woOf"),n=o.n(i),r=o("o9X6"),s=o("Zjyc"),c=o("0xDb"),l=o("7nIZ"),a=o("E4LH"),u=o("UQm2");t.a={components:{SelectTree:r.a,Upload:s.a},props:{popVisible:{type:Boolean,default:!1},info:{type:Object,default:function(){}},isModify:{type:Boolean,default:!1}},watch:{popVisible:{handler:function(e,t){e&&this.init()},immediate:!0},isModify:{handler:function(e,t){},immediate:!0},info:{handler:function(e,t){}}},computed:{isShow:{get:function(){return this.popVisible},set:function(){}},isCheck:{get:function(){return!1},set:function(){}}},data:function(){var e=function(e,t,o){a.a.ENGLISH_AND_NUMBER.test(t)||""===t?o():o(new Error("只可以输入阿拉伯数字和字母, 最多可输入25位"))};return{btnLoading:!1,subjectOne:[],subjectTwo:[],subjectThree:[],subjectFour:[],verificationWay:[],btnsize:"mini",dialogTitle:"记账凭证",loading:!0,formModel:{picsPath:"",paymentsType:"1"},rules:{amount:[{required:!0,message:"不能为空",trigger:"blur"}],verificationId:[{required:!0,message:"不能为空",trigger:"blur"}],subjectOneId:[{required:!0,message:"不能为空",trigger:"blur"}],receiptNo:[{validator:e,trigger:"blur"}],invoiceNo:[{validator:e,trigger:"blur"}],checkNo:[{validator:e,trigger:"blur"}],manualCert:[{validator:e,trigger:"blur"}]},formModelTitle:"现金记账凭证【出纳】",searchQuery:{orgId:"",dataSrc:1},searchQuerySub:{orgId:"",parentId:"",subjectLevel:""}}},methods:{init:function(){this.verificationWay=[],this.isShow=!0,this.searchQuery.orgId=this.otherinfo.orgid,this.searchQuerySub.orgId=this.otherinfo.orgid,this.isModify?(this.formModel=n()({},this.info),console.log("paymentsType",this.formModel.paymentsType),this.$set(this.formModel,"paymentsType",this.formModel.paymentsType+""),this.initSubject(),this.getVeryficationList(),this.loading=!1):(this.getBaseInfo(),this.getFinanceSubjects()),console.log("formModel",this.formModel)},getVeryficationList:function(){var t=this;Object(l.f)({orgId:this.otherinfo.orgid}).then(function(e){e&&(t.verificationWay=e)}).catch(function(e){t._handlerCatchMsg(e)})},initSubject:function(){var t=this;this.getFinanceSubjects().then(function(){if(t.formModel.subjectOneId){if(!t.checkSubject(1)){for(var e in t.formModel)/^subject/.test(e)&&(t.formModel[e]="");return}t.getFinanceSubjects(2,t.formModel.subjectOneId).then(function(){if(t.formModel.subjectTwoId){if(!t.checkSubject(2)){for(var e in t.formModel)/(Four|Three|Two)/.test(e)&&(t.formModel[e]="");return}t.getFinanceSubjects(3,t.formModel.subjectTwoId).then(function(){if(t.formModel.subjectThreeId){if(!t.checkSubject(3)){for(var e in t.formModel)/(Four|Three)/.test(e)&&(t.formModel[e]="");return}t.getFinanceSubjects(4,t.formModel.subjectThreeId).then(function(){if(t.formModel.subjectFourId&&!t.checkSubject(4))return t.formModel.subjectFourId="",void(t.formModel.subjectFourName="")})}})}})}})},getBaseInfo:function(){var t=this;return this.$set(this.searchQuery,"dataSrc",1),this.$set(this.searchQuery,"companyId",this.otherinfo.companyId),Object(l.j)(this.searchQuery).then(function(e){e&&(t.formModel=e,t.formModel.orgId=t.otherinfo.orgid,t.formModel.paymentsType=t.$options.data().formModel.paymentsType,t.verificationWay=e.verificationList,console.log("getBaseInfo",e),t.loading=!1)}).catch(function(e){t._handlerCatchMsg(e),t.loading=!1})},checkSubject:function(e){var t=this;switch(e){case 1:if(0<this.subjectOne.length)return 0!==this.subjectOne.filter(function(e){return e.id===t.formModel.subjectOneId}).length||(this.formModel.subjectOneId="",this.formModel.subjectOneName="",!1);console.warn("subjectTwoRule3",this.subjectTwoRule);break;case 2:if(0<this.subjectTwo.length)return 0!==this.subjectTwo.filter(function(e){return e.id===t.formModel.subjectTwoId}).length||(this.formModel.subjectTwoId="",this.formModel.subjectTwoName="",!1);break;case 3:if(0<this.subjectThree.length)return 0!==this.subjectThree.filter(function(e){return e.id===t.formModel.subjectThreeId}).length||(this.formModel.subjectThreeId="",this.formModel.subjectThreeName="",!1);break;case 4:if(0<this.subjectFour.length)return 0!==this.subjectFour.filter(function(e){return e.id===t.formModel.subjectFourId}).length||(this.formModel.subjectFourId="",this.formModel.subjectFourName="",!1)}},getFinanceSubjects:function(t,e){var o=this;for(var i in console.warn("getFinanceSubjects 科目",t,e),this.formModel)/^subject/.test(i)&&console.log(i,this.formModel[i]);return this.searchQuerySub.subjectLevel=t||"",this.searchQuerySub.parentId=e||"",Object(l.d)(this.searchQuerySub).then(function(e){switch(t){case 2:o.subjectTwo=e,o.subjectThree=[],o.subjectFour=[],console.log("科目二: ",o.subjectTwo),o.subjectTwo.forEach(function(e,t){console.log(t,e.id)});break;case 3:o.subjectThree=e,o.subjectFour=[],console.log("科目三: ",o.subjectThree),o.subjectThree.forEach(function(e,t){console.log(t,e.id)});break;case 4:o.subjectFour=e,console.log("科目四: ",o.subjectFour),o.subjectFour.forEach(function(e,t){console.log(t,e.id)});break;default:o.subjectOne=e,o.subjectTwo=[],o.subjectThree=[],o.subjectFour=[],console.log("科目一: ",o.subjectOne),o.subjectOne.forEach(function(e,t){console.log(t,e.id)})}}).catch(function(e){o._handlerCatchMsg(e)})},selectSubject:function(t,e){console.log(t);var o={};switch(e){case 1:for(var i in o=n()({},this.subjectOne.filter(function(e){return e.id===t})[0]),this.getFinanceSubjects(2,o.id),this.formModel)/^subject/.test(i)&&(this.formModel[i]="");this.formModel.subjectOneName=o.subjectName,this.formModel.subjectOneId=o.id,console.log("科目一 选中的值",o);break;case 2:for(var r in o=n()({},this.subjectTwo.filter(function(e){return e.id===t})[0]),this.getFinanceSubjects(3,o.id),this.formModel)/(Four|Three)/.test(r)&&(this.formModel[r]="");this.formModel.subjectTwoName=o.subjectName,console.log("科目二 选中的值",o);break;case 3:o=n()({},this.subjectThree.filter(function(e){return e.id===t})[0]),this.getFinanceSubjects(4,o.id),this.formModel.subjectThreeName=o.subjectName,this.formModel.subjectFourName="",this.formModel.subjectFourId="",console.log("科目三 选中的值",o);break;case 4:o=n()({},this.subjectFour.filter(function(e){return e.id===t})[0]),this.formModel.subjectFourName=o.subjectName}o={},console.log("formModel",this.formModel)},selectVerificationWay:function(t){console.log("selectVerificationWay",t);var e=n()({},this.verificationWay.filter(function(e){return e.id===t})[0]);this.formModel.verificationWay=e.verificationWay,console.log(this.formModel)},checkSubjectIsNull:function(){return!(0<this.subjectTwo.length)||(this.formModel.subjectTwoId?!(0<this.subjectThree.length)||(this.formModel.subjectThreeId?!(0<this.subjectFour.length)||(!!this.formModel.subjectFourId||(this.$message.warning("请填写四级科目"),!1)):(this.$message.warning("请填写三级科目"),!1)):(this.$message.warning("请填写二级科目!"),!1))},submitForm:function(e,o){var i=this;if(!this.formModel.certNo&&"1"===this.formModel.isNeededVoucher)return this.$message.error("缺少凭证编号"),void this.getBaseInfo();this.checkSubjectIsNull()&&this.$refs[e].validate(function(e){if(e){i.btnLoading=!0,i.loading=!0;var t=n()({},i.formModel);t.certTime||(t.certTime=new Date),i.$set(t,"certTime",Object(c.parseTime)(t.certTime,"{y}-{m}-{d}")+" 00:00:00"),i.$set(t,"dataSrc",t.id?t.dataSrc:1),i.isModify||(i.$set(t,"orderList",[]),t.orderList.push({shipLoadId:"",manualAmount:t.amount,subjectName:"",subjectId:""})),o&&(i.print(),i.loading=!1),console.log("query:::",t),delete t.verificationList,Object(l.g)(t).then(function(e){t={},i.closeMe(),i.$message.success("保存成功！"),i.$emit("success"),i.loading=!1,i.btnLoading=!1}).catch(function(e){i._handlerCatchMsg(e),i.loading=!1,i.btnLoading=!1})}})},print:function(){var e="?",t=n()({},this.formModel);for(var o in this.$set(t,"orgName",this.otherinfo.orgName),this.$set(t,"certTypeName","1"===t.certType?"冲销":"正常"),t.paymentsTypeZh="1"===t.paymentsType?"支出":"收入",t)e+=o+"="+(null===t[o]||void 0===t[o]||""===t[o]?"无":t[o])+"&";var i=window.location.protocol+"//"+window.location.host+"/static/print/voucher.html"+e+(new Date).getTime();Object(u.c)(encodeURI(i),"voucher")},setting:function(){this.$router.push({path:"/finance/financeInfo/subjectInfo"})},closeMe:function(){this.$emit("close"),"function"==typeof done&&done()}}}},wgpT:function(e,t,o){"use strict";var i={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:" incomeDialog",attrs:{title:t.dialogTitle,visible:t.isShow,"close-on-click-modal":!1,"before-close":t.closeMe},on:{"update:visible":function(e){t.isShow=e}}},[o("h4",{staticClass:"income_title"},[t._v(t._s(t.formModelTitle))]),t._v(" "),o("el-form",{ref:"formModel",attrs:{model:t.formModel,rules:t.rules,inline:!0,"label-width":"120px"}},[o("div",{staticClass:"income_item"},[o("el-form-item",{attrs:{label:"记账网点"}},[o("SelectTree",{attrs:{orgid:t.otherinfo.orgid,size:t.btnsize},model:{value:t.formModel.orgId,callback:function(e){t.$set(t.formModel,"orgId",e)},expression:"formModel.orgId"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"凭证编号",prop:"certNo"}},[o("el-input",{attrs:{placeholder:"凭证编号",size:t.btnsize,disabled:""},model:{value:t.formModel.certNo,callback:function(e){t.$set(t.formModel,"certNo",e)},expression:"formModel.certNo"}})],1),t._v(" "),o("el-form-item")],1),t._v(" "),o("div",{staticClass:"income_item_line"}),t._v(" "),o("div",{staticClass:"income_item"},[o("el-form-item",{attrs:{label:"记账方向"}},[o("el-select",{attrs:{placeholder:"请选择",size:t.btnsize,disabled:0===t.formModel.dataSrc},model:{value:t.formModel.paymentsType,callback:function(e){t.$set(t.formModel,"paymentsType",e)},expression:"formModel.paymentsType"}},t._l(t.$const.SETTLEMENT_ID,function(e,t){return o("el-option",{key:t,attrs:{value:t,label:e}})}))],1),t._v(" "),o("el-form-item",{attrs:{label:"凭证日期",prop:"certTime"}},[o("el-date-picker",{attrs:{type:"date",size:t.btnsize,placeholder:"选择日期",clearable:!1},model:{value:t.formModel.certTime,callback:function(e){t.$set(t.formModel,"certTime",e)},expression:"formModel.certTime"}})],1),t._v(" "),o("el-form-item",{staticClass:"formItemTextDanger",attrs:{label:"去向",prop:"verificationId"}},[o("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择",size:t.btnsize},on:{change:t.selectVerificationWay},model:{value:t.formModel.verificationId,callback:function(e){t.$set(t.formModel,"verificationId",e)},expression:"formModel.verificationId"}},t._l(t.verificationWay,function(e,t){return o("el-option",{key:t,attrs:{label:e.verificationWay,value:e.id}})}))],1)],1),t._v(" "),o("div",{staticClass:"income_item"},[o("el-form-item",{class:{formItemTextDanger:"1"===t.formModel.isNeededVoucher},attrs:{label:"一级科目",prop:"1"===t.formModel.isNeededVoucher?"subjectOneId":""}},[o("el-select",{attrs:{filterable:"",placeholder:"请选择",size:t.btnsize,disabled:"1"!==t.formModel.isNeededVoucher},on:{change:function(e){return t.selectSubject(e,1)}},model:{value:t.formModel.subjectOneId,callback:function(e){t.$set(t.formModel,"subjectOneId",e)},expression:"formModel.subjectOneId"}},t._l(t.subjectOne,function(e,t){return o("el-option",{key:t,attrs:{label:e.subjectName,value:e.id}})}))],1),t._v(" "),o("el-form-item",{class:0<t.subjectTwo.length?"formItemTextDanger":"",attrs:{label:"二级科目",prop:"subjectTwoId"}},[o("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择",size:t.btnsize,disabled:"1"!==t.formModel.isNeededVoucher},on:{change:function(e){return t.selectSubject(e,2)}},model:{value:t.formModel.subjectTwoId,callback:function(e){t.$set(t.formModel,"subjectTwoId",e)},expression:"formModel.subjectTwoId"}},t._l(t.subjectTwo,function(e,t){return o("el-option",{key:t,attrs:{label:e.subjectName,value:e.id}})}))],1),t._v(" "),o("el-form-item",{class:0<t.subjectThree.length?"formItemTextDanger":"",attrs:{label:"三级科目"}},[o("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择",size:t.btnsize,disabled:"1"!==t.formModel.isNeededVoucher},on:{change:function(e){return t.selectSubject(e,3)}},model:{value:t.formModel.subjectThreeId,callback:function(e){t.$set(t.formModel,"subjectThreeId",e)},expression:"formModel.subjectThreeId"}},t._l(t.subjectThree,function(e,t){return o("el-option",{key:t,attrs:{label:e.subjectName,value:e.id}})}))],1)],1),t._v(" "),o("div",{staticClass:"income_item"},[o("el-form-item",{class:0<t.subjectFour.length?"formItemTextDanger":"",attrs:{label:"四级科目"}},[o("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择",size:t.btnsize,disabled:"1"!==t.formModel.isNeededVoucher},on:{change:function(e){return t.selectSubject(e,4)}},model:{value:t.formModel.subjectFourId,callback:function(e){t.$set(t.formModel,"subjectFourId",e)},expression:"formModel.subjectFourId"}},t._l(t.subjectFour,function(e,t){return o("el-option",{key:t,attrs:{label:e.subjectName,value:e.id}})}))],1),t._v(" "),o("el-form-item",{attrs:{label:"凭证类别"}},[o("el-select",{attrs:{filterable:"",placeholder:"请选择",size:t.btnsize},model:{value:t.formModel.certType,callback:function(e){t.$set(t.formModel,"certType",e)},expression:"formModel.certType"}},t._l(t.$const.CERT_TYPE,function(e,t){return o("el-option",{key:t,attrs:{value:t,label:e}})}))],1),t._v(" "),o("el-form-item",{staticClass:"formItemTextDanger",attrs:{label:"发生金额",prop:"amount"}},[o("el-input",{directives:[{name:"numberOnly",rawName:"v-numberOnly:point",arg:"point"}],attrs:{placeholder:"发生金额",size:t.btnsize,maxlength:8,disabled:"核销产生"===t.formModel.dataSrcZh},model:{value:t.formModel.amount,callback:function(e){t.$set(t.formModel,"amount",t._n(e))},expression:"formModel.amount"}})],1)],1),t._v(" "),o("div",{staticClass:"income_item_line"}),t._v(" "),o("div",{staticClass:"income_item"},[o("el-form-item",{attrs:{label:"收据号码",prop:"receiptNo"}},[o("el-input",{attrs:{placeholder:"收据号码",size:t.btnsize,maxlength:25},model:{value:t.formModel.receiptNo,callback:function(e){t.$set(t.formModel,"receiptNo",e)},expression:"formModel.receiptNo"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"发票号码",prop:"invoiceNo"}},[o("el-input",{attrs:{placeholder:"发票号码",size:t.btnsize,maxlength:25},model:{value:t.formModel.invoiceNo,callback:function(e){t.$set(t.formModel,"invoiceNo",e)},expression:"formModel.invoiceNo"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"支票号码",prop:"checkNo"}},[o("el-input",{attrs:{placeholder:"支票号码",size:t.btnsize,maxlength:25},model:{value:t.formModel.checkNo,callback:function(e){t.$set(t.formModel,"checkNo",e)},expression:"formModel.checkNo"}})],1)],1),t._v(" "),o("div",{staticClass:"income_item"},[o("el-form-item",{attrs:{label:"手工凭证",prop:"manualCert"}},[o("el-input",{attrs:{placeholder:"手工凭证",size:t.btnsize,maxlength:25},model:{value:t.formModel.manualCert,callback:function(e){t.$set(t.formModel,"manualCert",e)},expression:"formModel.manualCert"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"摘要"}},[o("el-input",{attrs:{placeholder:"摘要",size:t.btnsize,maxlength:50},model:{value:t.formModel.remark,callback:function(e){t.$set(t.formModel,"remark",e)},expression:"formModel.remark"}})],1),t._v(" "),o("el-form-item")],1),t._v(" "),o("div",{staticClass:"income_item_line"}),t._v(" "),o("div",{staticClass:"income_item_row"},[o("p",{staticStyle:{"margin-left":"15px"}},[t._v("图片上传\n        "),o("el-tag",{attrs:{size:t.btnsize}},[t._v("注：最多可上传5张图片，每张图片不能大于5M")])],1),t._v(" "),o("el-form-item",{staticClass:"clearfix"},[o("div",{staticClass:"clearfix uploadcard"},[o("Upload",{attrs:{title:"本地上传",showFileList:!0,limit:5,listtype:"picture",disabled:t.isCheck},model:{value:t.formModel.picsPath,callback:function(e){t.$set(t.formModel,"picsPath",e)},expression:"formModel.picsPath"}})],1)])],1),t._v(" "),o("div",{staticClass:"income_item_line"})]),t._v(" "),o("span",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-document",loading:t.btnLoading},on:{click:function(e){t.submitForm("formModel")}}},[t._v("保存")]),t._v(" "),o("el-button",{attrs:{type:"success",plain:"",icon:"el-icon-printer",loading:t.btnLoading},on:{click:function(e){t.submitForm("formModel","print")}}},[t._v("保存并打印")]),t._v(" "),"1"===t.formModel.isNeededVoucher?o("el-button",{attrs:{type:"warning",plain:"",icon:"el-icon-setting"},on:{click:t.setting}},[t._v("设置财务科目")]):t._e(),t._v(" "),o("el-button",{attrs:{type:"danger",plain:"",icon:"el-icon-circle-close"},on:{click:t.closeMe}},[t._v("取消")])],1)],1)},staticRenderFns:[]};t.a=i}});