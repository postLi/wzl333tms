webpackJsonp([198],{"//Ie":function(e,t,o){"use strict";var i=o("woOf"),s=o.n(i),r=o("Dd8w"),n=o.n(r),a=o("E4LH"),l=o("Vi15"),c=o("P5Di"),m=o("QbVN"),u=o("o9X6"),d=o("NYxO");t.a={components:{popRight:c.a,Upload:m.a,SelectTree:u.a},props:{popVisible:{type:Boolean,default:!1},orgid:{required:!0},isModify:{type:Boolean,default:!1},info:{type:Object,default:function(){}},issender:{type:Boolean,dafault:!1}},computed:n()({},Object(d.mapGetters)(["otherinfo"]),{fixPhone:{get:function(){return this.phoneshort+"-"+this.phonelong},set:function(e){var t=e?e.split("-"):"";t?(this.phoneshort=t[1]?t[0]:"",this.phonelong=t[1]?t[1]:t[0]):(this.phoneshort="",this.phonelong="")}},customphoneisok:function(){}}),data:function(){return{phoneshort:"",phonelong:"",form:{bankCardNumber:"",bankName:"",companyName:"",companyType:2,customerMobile:"",customerName:"",customerType:this.issender?1:2,customerUnit:"",detailedAddress:"",fixPhone:"",idcardPositive:"",idcardVerso:"",idcard:"",legalPersonname:"",licensePicture:"",openBank:"",orgid:0,vipNum:""},formLabelWidth:"90px",tooltip:!1,rules:{companyName:[],orgid:[{required:!0,message:"请选择所属机构"}],customerMobile:[{required:!0,message:"请输入手机号码",trigger:"change"}],customerName:[{required:!0,message:"请输入联系人"},{max:30,message:"不能超过30个字符"}],vipNum:[{pattern:a.a.ONLY_NUMBER_AND_LETTER,trigger:"blur",message:"客户的VIP号只能输入字母和阿拉伯数字"}],idcard:[{pattern:a.a.ONLY_NUMBER_AND_LETTER,trigger:"blur",message:"身份证号码只能输入字母和数字"}]},popTitle:"新增发货人",orgArr:[],rolesArr:[],departmentArr:[],loading:!1,roles:[],departments:[],groups:[],inited:!1,isSaveAndAdd:!0}},mounted:function(){this.form.orgid=this.orgid,this.inited||(this.inited=!0,this.initInfo()),console.log(this.issender),console.log(this.popTitle)},watch:{"form.customerMobile":function(e){this.isSaveAndAdd&&(console.log("33333"),this.$refs.ruleForm.validateField("customerMobile"))},popVisible:function(e,t){this.inited||(this.inited=!0,this.initInfo()),e&&this.setTitle(),console.log(this.popTitle)},orgid:function(e){this.form.orgid=e},info:function(){if(this.isModify){this.popTitle="修改"+(this.issender?"发":"收")+"货人";var e=s()({},this.info);for(var t in this.form)this.form[t]=e[t];this.form.customerId=e.customerId,console.log("this.fixphone",this.fixPhone,this.form.fixPhone,e),this.fixPhone=this.form.fixPhone}else{for(var o in console.log(this.issender),this.popTitle="新增"+(this.issender?"发":"收")+"货人",this.form)this.form[o]="";delete this.form.customerId,this.form.companyType=2,this.form.customerType=this.issender?1:2,this.form.orgid=this.orgid,this.fixPhone=""}}},methods:{setTitle:function(){if(this.isModify){this.popTitle="修改"+(this.issender?"发":"收")+"货人";var e=s()({},this.info);for(var t in this.form)this.form[t]=e[t];this.form.customerId=e.customerId,console.log("this.fixphone",this.fixPhone,this.form.fixPhone,e),this.fixPhone=this.form.fixPhone}else{for(var o in console.log(this.issender),this.popTitle="新增"+(this.issender?"发":"收")+"货人",this.form)this.form[o]="";delete this.form.customerId,this.form.companyType=2,this.form.customerType=this.issender?1:2,this.form.orgid=this.orgid,this.fixPhone=""}},initInfo:function(){this.loading=!1},getOrgid:function(e){this.form.orgid=e},submitForm:function(e,o){var i=this;this.$refs[e].validate(function(e){if(!e)return!1;i.loading=!0;var t=s()({},i.form);t.fixPhone=i.fixPhone;(i.isModify?Object(l.e)(t):Object(l.d)(t)).then(function(e){i.loading=!1,i.$message.success("保存成功"),o||i.closeMe(),i.$emit("success"),i.reset()}).catch(function(e){i._handlerCatchMsg(e),i.loading=!1})})},reset:function(){var e=this;this.isSaveAndAdd=!1;var t=this.form.orgid;this.$refs.ruleForm.resetFields(),this.form.licensePicture="",this.form.idcardPositive="",this.form.idcardVerso="",this.fixPhone="",this.form.fixPhone="",this.form.customerMobile="",this.form.orgid=t,console.log(this.form,"///////////////"),this.$nextTick(function(){e.isSaveAndAdd=!0})},closeMe:function(e){this.reset(),this.$emit("update:popVisible",!1),"function"==typeof e&&e()}}}},"0Q33":function(e,t){},"71e1":function(e,t,o){e.exports=o("+dzQ")(43)},EPeO:function(e,t,o){"use strict";var i=o("//Fk"),n=o.n(i),s=o("mvHQ"),r=o.n(s),a=(o("UDRQ"),o("t5DY")),l=o("0xDb"),c=o("71e1"),m=o.n(c),u=o("Vo7i");t.a={name:"singleImageUpload",props:{value:[String,Array],title:{type:String,default:""},tip:{type:String,default:"（jpg/png。小于5M）"},size:{type:String,default:"mini"},showFileList:{type:Boolean,default:!1},limit:{type:Number,default:1},listtype:{type:String,default:"picture",enum:["text","picture","picture-card"]},disabled:{type:Boolean,default:!1},twocode:{type:Boolean,default:!1}},computed:{imageUrl:function(){return this.value}},data:function(){return{tempUrl:"",dataObj:{token:"",key:""},upload:{key:"",policy:"",OSSAccessKeyId:"",success_action_status:"201",signature:""},uploadUrl:"",dir:"",filelist:[],showtc:!1,showtwocdetip:!0,twocodeurl:""}},watch:{showtc:function(){this.showtc?this.changeTwocode():clearInterval(this.uptimer)},value:{handler:function(e){if(this.showFileList){var t=Array.isArray(e)?e:e?e.split(","):[];t=t.filter(function(e){return e}),this.filelist=[],this.filelist=t.map(function(e){var t={};return t.url=e,t})}else this.filelist=e?[{url:e}]:[]},immediate:!0}},mounted:function(){},updated:function(){console.log("single image updated~~~")},beforeDestroy:function(){console.log("beforeDestroy"),clearInterval(this.uptimer)},methods:{init:function(){var t=this;return Object(a.m)().then(function(e){t.upload.OSSAccessKeyId=e.accessid,t.upload.policy=e.policy,t.upload.signature=e.signature,t.uploadUrl=e.host,t.dir=e.dir}).catch(function(){})},rmImage:function(t){this.filelist=this.filelist.filter(function(e){return e.url!==t}),this.emitInput(""),this.showtc=!1},onexceed:function(e,t){this.$message.error("最多上传 "+this.limit+" 张!")},handleRemove:function(e,t){console.log("handleRemove:",e,t),this.filelist=t,this.emitInput()},random_string:function(e){e=e||32;for(var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",o=t.length,i="",s=0;s<e;s++)i+=t.charAt(Math.floor(Math.random()*o));return i},emitInput:function(e){e&&this.filelist.push({url:e}),this.$emit("input",this.showFileList?this.filelist.map(function(e){return e.url}).join(","):e)},handleImageScucess:function(e){var t="";-1!==e.indexOf("Location")&&(t=(t=e.match(/<Location>([^<]+)<\/Location>/m))?t[1]:""),this.emitInput(t)},handleError:function(e){this.$message.error("上传错误："+r()(e)),this.$emit("error",e)},handleUpload:function(e){var r=this;return new n.a(function(i,s){lrz(e.file,{width:1024}).then(function(e){var t=new FormData,o=r.uploadUrl;t.append("key",r.upload.key),t.append("success_action_status","201"),t.append("OSSAccessKeyId",r.upload.OSSAccessKeyId),t.append("policy",r.upload.policy),t.append("signature",r.upload.signature),t.append("file",e.file),u.b.post(o,t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){i(e)}).catch(function(e){s(e),r._handlerCatchMsg(e,"上传失败:")})}).catch(function(e){s(e),r._handlerCatchMsg(e,"上传失败：")})})},beforeUpload:function(e){var o=this,i=/image\/\w+/.test(e.type)&&/(jpe?g|png)/i.test(e.type),s=e.size/1024/1024<5,r=e.name.match(/([^\.]+)$/);return r=r?"."+r[1]:"",new n.a(function(t,e){i?s?o.init().then(function(e){o.upload.key=o.dir+Object(l.parseTime)(new Date,"{y}{m}{d}")+"/"+o.random_string()+r,t(!0)}).catch(function(e){o._handlerCatchMsg(e),t(!1)}):(o.$message.error("上传头像图片大小不能超过 5MB!"),e(!1)):(o.$message.error("上传头像图片只能是 JPG/PNG 格式!"),e(!1))})},changeTwocode:function(){var o=this;clearInterval(this.uptimer),Object(a.k)().then(function(e){o.upid=e.data,o.startFetchData();var t="http://"+location.host+"/static/upload.html?len=1&access_token="+o.access_token+"&id="+e.data+"&url="+(window.tms_testapiurl||"");console.log("url:",t),m.a.toDataURL(t,{rendererOpts:{margin:0}}).then(function(e){o.twocodeurl=e})}).catch(function(e){o.$message.error("生成二维码出错了~")})},startFetchData:function(){var o=this;clearInterval(this.uptimer);var e=0;this.uptimer=setInterval(function(){if(57e4<(e+=5e3))return o.$message.info("二维码过期了，已重新生成~"),o.changeTwocode(),!1;Object(a.l)(o.upid).then(function(e){var t=e.data;t&&t.id===o.upid&&t.url&&(clearInterval(o.uptimer),o.showtc=!1,o.emitInput(decodeURIComponent(t.url)))}).catch(function(e){o.$message.info("二维码过期了，请重新扫描上传~")})},5e3)}}}},QbVN:function(e,t,o){"use strict";var i=o("EPeO"),s=o("jxZV");var r=function(e){o("0Q33"),o("xU5l")},n=o("VU/8")(i.a,s.a,r,"data-v-de7091b2",null);t.a=n.exports},XRGj:function(e,t,o){"use strict";var i={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("pop-right",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"addCustomerPop",attrs:{title:t.popTitle,isShow:t.popVisible},on:{close:t.closeMe}},[o("template",{staticClass:"addCustomerPop-content",slot:"content"},[o("el-form",{ref:"ruleForm",attrs:{model:t.form,rules:t.rules,"label-width":t.formLabelWidth,inline:!0,"label-position":"right",size:"mini"}},[t.isModify?t._e():o("el-form-item",{staticClass:"clearfix"},[o("div",{staticClass:"selectType",class:{checked:2===t.form.companyType},on:{click:function(e){e.stopPropagation(),t.form.companyType=2}}},[o("span",{staticClass:"icon"},[o("icon-svg",{attrs:{"icon-class":"qiye"}})],1),t._v(" "),o("strong",[t._v("企业")]),t._v(" "),o("p",[t._v("有合法营业执照等企业")])]),t._v(" "),o("div",{staticClass:"selectType single",class:{checked:1===t.form.companyType},on:{click:function(e){e.stopPropagation(),t.form.companyType=1}}},[o("span",{staticClass:"icon"},[o("icon-svg",{attrs:{"icon-class":"geren"}})],1),t._v(" "),o("strong",[t._v("个人")]),t._v(" "),o("p",[t._v("具备有效身份的自然人")])])]),t._v(" "),2===t.form.companyType?[o("div",{staticClass:"info"},[t._v("公司名称")]),t._v(" "),o("el-form-item",{attrs:{prop:"companyName"}},[o("el-input",{attrs:{maxlength:25,placeholder:"公司全称"},model:{value:t.form.companyName,callback:function(e){t.$set(t.form,"companyName","string"==typeof e?e.trim():e)},expression:"form.companyName"}})],1),t._v(" "),o("el-form-item",[o("upload",{staticClass:"licensePicture",attrs:{twocode:"",tip:"（有年检章，jpg/png。小于5M）"},model:{value:t.form.licensePicture,callback:function(e){t.$set(t.form,"licensePicture",e)},expression:"form.licensePicture"}})],1),t._v(" "),o("div",{staticClass:"info"},[t._v("公司法人信息")]),t._v(" "),o("el-form-item",{attrs:{prop:"legalPersonname"}},[o("el-input",{attrs:{maxlength:25,placeholder:"公司法人名称","auto-complete":"off"},model:{value:t.form.legalPersonname,callback:function(e){t.$set(t.form,"legalPersonname","string"==typeof e?e.trim():e)},expression:"form.legalPersonname"}})],1)]:t._e(),t._v(" "),o("el-form-item",{staticClass:"clearfix"},[o("div",{staticClass:"idcard-pos"},[o("upload",{attrs:{twocode:"",title:1===t.form.companyType?"自然人身份证正面":"法人身份证正面"},model:{value:t.form.idcardPositive,callback:function(e){t.$set(t.form,"idcardPositive",e)},expression:"form.idcardPositive"}})],1),t._v(" "),o("div",{staticClass:"idcard-ver"},[o("upload",{attrs:{twocode:"",title:1===t.form.companyType?"自然人身份证反面":"法人身份证反面"},model:{value:t.form.idcardVerso,callback:function(e){t.$set(t.form,"idcardVerso",e)},expression:"form.idcardVerso"}})],1)]),t._v(" "),o("div",{staticClass:"info"},[t._v(t._s(t.issender?"发":"收")+"货信息")]),t._v(" "),o("el-form-item",{attrs:{label:(t.issender?"发":"收")+"货方",prop:"customerUnit"}},[o("el-input",{attrs:{maxlength:25,"auto-complete":"off"},model:{value:t.form.customerUnit,callback:function(e){t.$set(t.form,"customerUnit",e)},expression:"form.customerUnit"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"联系人",prop:"customerName"}},[o("el-input",{attrs:{maxlength:25,"auto-complete":"off"},model:{value:t.form.customerName,callback:function(e){t.$set(t.form,"customerName",e)},expression:"form.customerName"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"手机",prop:"customerMobile"}},[o("input",{directives:[{name:"numberOnly",rawName:"v-numberOnly"},{name:"model",rawName:"v-model.trim",value:t.form.customerMobile,expression:"form.customerMobile",modifiers:{trim:!0}}],staticClass:"nativeinput",attrs:{type:"text","auto-complete":"off",maxlength:"20"},domProps:{value:t.form.customerMobile},on:{input:function(e){e.target.composing||t.$set(t.form,"customerMobile",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),o("el-form-item",{staticClass:"customerPhone",attrs:{label:"电话",prop:"customerPhone"}},[o("el-input",{directives:[{name:"numberOnly",rawName:"v-numberOnly"}],staticClass:"phoneshort",attrs:{maxlength:4,"auto-complete":"off"},model:{value:t.phoneshort,callback:function(e){t.phoneshort=e},expression:"phoneshort"}}),t._v(" - "),o("el-input",{directives:[{name:"numberOnly",rawName:"v-numberOnly"}],staticClass:"phonelong",attrs:{maxlength:8,"auto-complete":"off"},model:{value:t.phonelong,callback:function(e){t.phonelong=e},expression:"phonelong"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"归属网点",prop:"orgid"}},[o("SelectTree",{attrs:{filterable:"",orgid:t.otherinfo.orgid},model:{value:t.form.orgid,callback:function(e){t.$set(t.form,"orgid",e)},expression:"form.orgid"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"客户VIP号",prop:"vipNum"}},[o("el-input",{attrs:{maxlength:25,"auto-complete":"off"},model:{value:t.form.vipNum,callback:function(e){t.$set(t.form,"vipNum",e)},expression:"form.vipNum"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"身份证号码",prop:"idcard"}},[o("el-input",{attrs:{maxlength:18,"auto-complete":"off"},model:{value:t.form.idcard,callback:function(e){t.$set(t.form,"idcard",e)},expression:"form.idcard"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"开户行",prop:"openBank"}},[o("el-input",{attrs:{maxlength:20,"auto-complete":"off"},model:{value:t.form.openBank,callback:function(e){t.$set(t.form,"openBank",e)},expression:"form.openBank"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"银行名称",prop:"bankName"}},[o("el-input",{attrs:{maxlength:20,"auto-complete":"off"},model:{value:t.form.bankName,callback:function(e){t.$set(t.form,"bankName",e)},expression:"form.bankName"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"银行卡号",prop:"bankCardNumber"}},[o("el-input",{directives:[{name:"numberOnly",rawName:"v-numberOnly"}],attrs:{maxlength:25,"auto-complete":"off"},model:{value:t.form.bankCardNumber,callback:function(e){t.$set(t.form,"bankCardNumber","string"==typeof e?e.trim():e)},expression:"form.bankCardNumber"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"详细地址",prop:"detailedAddress"}},[o("el-input",{attrs:{type:"textarea",placeholder:"最多输入50个字符",maxlength:50,"auto-complete":"off"},model:{value:t.form.detailedAddress,callback:function(e){t.$set(t.form,"detailedAddress",e)},expression:"form.detailedAddress"}})],1)],2)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t.isModify?t._e():o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm("ruleForm",!0)}}},[t._v("保存并新增")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("保 存")]),t._v(" "),o("el-button",{on:{click:t.closeMe}},[t._v("取 消")])],1)],2)},staticRenderFns:[]};t.a=i},ftoq:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o("//Ie"),s=o("XRGj");var r=function(e){o("nveU")},n=o("VU/8")(i.a,s.a,r,null,null);t.default=n.exports},jxZV:function(e,t,o){"use strict";var i={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"upload-container",class:{uploadlist:t.showFileList}},[o("el-upload",{staticClass:"image-uploader",attrs:{data:t.upload,action:t.uploadUrl,multiple:!1,drag:!t.showFileList,"show-file-list":t.showFileList,"file-list":t.filelist,limit:t.limit,"before-upload":t.beforeUpload,"list-type":t.listtype,"on-exceed":t.onexceed,disabled:t.disabled,"on-remove":t.handleRemove,"on-error":t.handleError,"http-request":t.handleUpload,"on-success":t.handleImageScucess}},[t._t("content",[t.showtc?o("div",{staticClass:"twocodebox",on:{click:function(e){e.stopPropagation(),e.preventDefault()},mouseover:function(e){t.showtwocdetip=!0},mouseout:function(e){t.showtwocdetip=!1}}},[o("div",[o("img",{attrs:{src:t.twocodeurl,alt:""}})]),t._v(" "),o("el-button",{attrs:{size:t.size,type:"primary"},on:{click:function(e){t.showtc=!1}}},[t._v("本地上传")]),t._v(" "),o("el-button",{attrs:{size:t.size,type:"primary"},on:{click:t.changeTwocode}},[t._v("更换二维码")])],1):o("div",[t.title&&!t.showFileList?o("div",{staticClass:"upload__title"},[t._v(t._s(t.title))]):t._e(),t._v(" "),o("el-button",{attrs:{size:t.size,type:"primary"}},[t._v("点击上传")]),t._v(" "),t.twocode?o("el-button",{staticClass:"uploadtwocode",attrs:{size:t.size,type:"primary"},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.showtc=!0}}},[t._v("二维码上传")]):t._e(),t._v(" "),t.showFileList?t._e():o("div",{staticClass:"el-upload__text"},[t._v("将文件拖拽到此区域")]),t._v(" "),t.tip?o("div",{staticClass:"upload__tip"},[t._v(t._s(t.tip))]):t._e()],1)])],2),t._v(" "),t.imageUrl&&!t.showFileList?o("div",{staticClass:"image-preview"},[o("div",{staticClass:"image-preview-wrapper"},[o("img",{attrs:{src:t.imageUrl}}),t._v(" "),o("div",{staticClass:"image-preview-action"},[o("i",{staticClass:"el-icon-delete",on:{click:function(e){t.rmImage(t.imageUrl)}}})])])]):t._e()],1)},staticRenderFns:[]};t.a=i},nveU:function(e,t){},xU5l:function(e,t){}});