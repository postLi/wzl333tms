# 上传图片

## 流程
1. 获取参数
2. 上传图片（增删）
3. 确定上传的图片
4. 关闭页面，跳转到xx页面或者提示用户关闭页面

## 逻辑
1. 通过链接拿到参数
2. 验证token信息（拿一次plicy）  
   如果token无效，提示关闭页面，重新扫描二维码
3. 界面：  
   没有上传图片前，一个大大的上传按钮  
   上传图片后，一个图片列表，下面一个“继续上传”按钮 + “选择完毕” 按钮  
   图片列表为缩略图，点击缩略图弹出大图查看；   
   缩略图右上角有个“删除”按钮，可以删除选择的图重新再上传；  
   当列表的数量达到最大数量时，隐藏“继续上传”按钮；  
4. 上传图片时：  
   先拿取policy；  
   再上传图片到阿里云；  
   将获得的图片链接展示到图片列表中；  
5. 确定选择时：  
   先判断有无上传的图片，没有则先提示用户是否放弃上传关闭页面；  
   如果有图片，则请求提交接口；  
   提交成功转到【流程4】；

## 异常情况
1. 进入页面时的token已失效，如何通知页面更新二维码？
2. 在页面上操作的过程中token失效，同【异常1】
3. 图片上传失败时，如何重新上传？
4. 提交不成功时，是反复提示用户点击重新请求？还是操作达到一定次数提示用户重新刷二维码进入页面？回到【异常1】，怎么通知页面更新二维码？


## 参考文档

### LRZ
``` javascript
 lrz(this.files[0], option)  
  .then(function (rst) {  
      // 处理成功会执行  
      console.log(rst);  
  })  
  .catch(function (err) {  
      // 处理失败会执行  
  })  
  .always(function () {  
      // 不管是成功失败，都会执行  
  }); 
  option 对象参数  
  width {Number} 图片最大不超过的宽度，默认为原图宽度，高度不设时会适应宽度。  
  height {Number} 同上  
  quality {Number} 图片压缩质量，取值 0 - 1，默认为0.7  
  fieldName {String} 后端接收的字段名，默认：file  

返回对象参数  
then(rst)  
rst.formData 后端可处理的数据  
rst.file 压缩后的file对象（默认已经丢在rst.formData有一份了），需要注意的是如果压缩率太低的话，这个会是原始的file对象  
rst.fileLen 生成后的图片的大小，后端可以通过此值来校验是否传输完整  
rst.base64 生成后的图片base64，后端可以处理此字符串为图片，也直接用于img.src = base64  
rst.base64Len 生成后的base64的大小，后端可以通过此值来校验是否传输完整 (如果采用base64上传方式)  
rst.origin 也就是原始的file对象，里面存了一些原始文件的信息，例如大小，日期等。

```