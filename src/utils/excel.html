<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <button id="save">保存</button>
  <script src="./exceljs.min.js"></script>
  <script src="./fileSaver.js"></script>
  <script>
  var a = document.getElementById('save')
  a.onclick = function(){
    var workbook = new ExcelJS.Workbook()
   workbook.creator = '28TMS'
   workbook.lastModifiedBy = '28TMS'
   workbook.created = new Date()
   workbook.modified = new Date()
   workbook.lastPrinted = new Date()
   var option ={}

   // 暂时只处理第一个表格
   // 如果需要，可以改成遍历表格
   const data = []

   // 表格名称
   var worksheet = workbook.addWorksheet('Sheet')
   // 冻结第一行
   worksheet.views = [{
     state: 'frozen',
     xSplit: 0,
     ySplit: 1
   }]

   worksheet.columns = [
      { header: 'Index', key: 'Index', width: 15 },
      { header: 'Title', key: 'title', width: 25, style: { alignment: { wrapText: true }}},
      { header: 'Authors', key: 'authors', width: 20, style: { alignment: { wrapText: true }}},
      { header: 'Journal/Conference', key: 'jc', width: 25, style: { alignment: { wrapText: true }}},
      { header: 'Type', key: 'type', width: 12, style: { alignment: { wrapText: true }}},
      { header: 'Year', key: 'year', width: 12, style: { numFmt: '0000' }},
      { header: 'Month', key: 'month', width: 12 },
      { header: 'volume', key: 'volume', width: 12 },
      { header: 'number', key: 'number', width: 12 },
      { header: 'Pages', key: 'pages', width: 12 },
      { header: 'Location', key: 'location', width: 20, style: { alignment: { wrapText: true }}},
      { header: 'doi', key: 'doi', width: 22, style: { alignment: { wrapText: true }}},
      { header: 'affiliation', key: 'affiliation', width: 20, style: { alignment: { wrapText: true }}}
      ] 

   worksheet.mergeCells('A1:A2')
   worksheet.getCell('B1').value="B2"
   worksheet.getCell('D1').value="D2"

   worksheet.mergeCells('B1','D1')
   worksheet.getCell('B1').value={
  text: 'www.mylink.com',
  hyperlink: 'http://www.mylink.com',
  tooltip: 'www.mylink.com'
}
   worksheet.getCell('D1').value="D2"

   worksheet.getCell('B2').value="b2"
   worksheet.getCell('C2').value="C2"
   worksheet.getCell('D2').value="D2"
   worksheet.getCell('B2').value="b3"


   // 添加过滤器
   /* worksheet.autoFilter = {
     from: 'A1',
     to: 'M1'
   } */
   // 定义列样式
   const columnsStyle = {
     alignment: {
       wrapText: true,
       horizontal: 'center',
       vertical: 'middle'
     },
     border: {
       top: {
         style: 'thin',
         color: {
           argb: 'FF999999'
         }
       },
       left: {
         style: 'thin',
         color: {
           argb: 'FF999999'
         }
       },
       bottom: {
         style: 'thin',
         color: {
           argb: 'FF999999'
         }
       },
       right: {
         style: 'thin',
         color: {
           argb: 'FF999999'
         }
       }
     }
   }
   const columns = []
   /* data.sheetHeader.forEach((el, index) => {
     columns.push({
       header: el,
       key: data.sheetFilter[index] || 'index',
       width: 15,
       height: 20,
       style: columnsStyle
     })
   })
   worksheet.columns = columns */
      

   // 设置第一行标题样式
   var firstRow = worksheet.getRow(1)
   firstRow.font = {
     name: 'MicrosoftYaHei',
     family: 1,
     size: 10,
     bold: true,
     color: {
       argb: '80333333'
     }
   }
   firstRow.alignment = {
     vertical: 'middle',
     horizontal: 'center'
   }
   firstRow.height = 20
   firstRow.border = {
     top: {
       style: 'thin',
       color: {
         argb: 'FF999999'
       }
     },
     left: {
       style: 'thin',
       color: {
         argb: 'FF999999'
       }
     },
     bottom: {
       style: 'thin',
       color: {
         argb: 'FF999999'
       }
     },
     right: {
       style: 'thin',
       color: {
         argb: 'FF999999'
       }
     }
   }
   firstRow.fill = {
     type: 'pattern',
     pattern: 'solid',
     fgColor: {
       argb: 'FFCCCCCC'
     }
   }



   const datas = []

   /* data.sheetData.map((el, index) => {
     const arr = []
     data.sheetFilter.map(ee => {
       arr.push(el[ee || 'index'])
     })
     datas.push(arr)
   }) */

   //  csv.shift();
   worksheet.addRows(datas)
   // 添加数据

   // 设置间隔样式
   // 除第一行外的奇数行设置背景色
   worksheet.eachRow({
     includeEmpty: true
   }, function(row, rowNumber) {
     //  console.log('Row ' + rowNumber + ' = ' + JSON.stringify(row.values))
     if (rowNumber > 1 && rowNumber % 2) {
       row.fill = {
         type: 'pattern',
         pattern: 'solid',
         fgColor: {
           argb: 'FFEEEEEE'
         }
       }
     }
   })


   var buff = workbook.xlsx.writeBuffer().then(function(data) {
     var blob = new Blob([data], {
       type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
     })
     saveAs(blob, ('报表') + '.xlsx')
   })
  }
  </script>
</body>
</html>